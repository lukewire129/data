---
title: Delta 라이브러리 만들기 기록
subtitle: Virtual DOM과 Diffing Algorithm
category: technology
tags: ["MVU", "WPF"]
date: '2024-11-28'
---
안녕하세요 이광석입니다.

WPF만의 MVU 패턴을 위한 라이브러리를 만드는 과정을 기록으로 남기기 위해 작성하려고 합니다.

이미 WPF 생태계에서는 `기본 컨트롤 자체가 MVVM 패턴을 사용해야 한다`는 것이 일반적인 자리로 잡혀 있기 때문에, MVU 패턴을 적용하는 데 어려움이 있습니다.

저는 WPF의 가장 기본적인 `Grid`, `StackPanel`, `Button`, `TextBox`, `Label`만을 가지고 MVU 패턴을 사용할 수 있게 만들려고 합니다.

오랜 시간이 걸릴 수 있지만, 언젠가는 가능하리라 생각합니다.

## 기본 개념

WPF 개발자라면 Virtual DOM과 Diffing Algorithm은 생소할 수밖에 없습니다. 하지만 현재 프론트엔드 트렌드에서는 가장 뛰어난 방식 중 하나로 자리 잡고 있습니다.

1. WPF도 결국 VisualTree 구조를 가지고 있습니다. VisualTree는 컨트롤들의 부모-자식 관계를 표현하는 구조로, WPF에서 화면 요소들이 어떻게 렌더링되는지 결정합니다.
2. Trigger와 VSM(VisualStateManager)을 통해 XAML에서 컨트롤의 상태를 변경할 수 있지만, 실제로 컨트롤은 메모리상에 계속 존재합니다. 이는 성능 상 비효율적인 경우가 발생할 수 있습니다. Virtual DOM을 이용한 방식은 이러한 상태 관리와 렌더링의 효율성을 개선하는 데 도움이 됩니다.

## MVU 패턴이란?

MVU(Model-View-Update) 패턴은 UI 업데이트를 일관되고 명확하게 처리할 수 있는 방법론입니다. 이는 Elm 아키텍처에서 영감을 받은 패턴으로, React나 Jetpack Compose 같은 현대적 UI 라이브러리에도 많은 영향을 주었습니다.

- **Model**: 애플리케이션의 상태를 나타내며, 변경이 일어날 때마다 불변성을 유지해야 합니다.
- **View**: 현재 상태(Model)를 기반으로 화면에 렌더링할 UI를 정의합니다.
- **Update**: 사용자 이벤트나 기타 입력을 통해 Model을 업데이트하는 함수입니다. 이 패턴은 단방향 데이터 흐름을 보장하여 상태의 변화를 예측 가능하게 만듭니다.

WPF에서 MVU를 구현하기 위해서는 기존의 MVVM과는 다른 방식으로 UI 상태 관리와 이벤트 처리가 필요합니다. 주로 불변의 Model을 사용하고, 상태가 변경될 때마다 전체 View를 재구성해주는 방식이기 때문에 기존 XAML 기반의 UI 업데이트 방식과는 상당히 다른 접근이 요구됩니다.

## WPF에서의 도전 과제

- **DataContext와 Binding**: WPF의 MVVM 패턴에서는 DataContext와 Binding을 통해 View와 ViewModel 간의 연결을 설정합니다. 반면, MVU에서는 이러한 직접적인 바인딩 대신 상태 변화에 따라 View 전체를 다시 렌더링하는 방식을 사용해야 합니다. 이는 WPF의 기존 데이터 바인딩 시스템과 충돌할 수 있으며, 성능 이슈도 발생할 수 있습니다.
- **이벤트 처리**: MVU에서는 이벤트가 발생할 때마다 상태를 변경하고 전체 View를 재구성하는 방식으로 동작합니다. 하지만 WPF의 이벤트 시스템은 특정 이벤트에 대한 핸들러를 정의하는 구조로, MVU의 단순하고 일관된 이벤트 처리와는 차이가 있습니다. 이를 해결하기 위해서는 이벤트를 상태 변경 함수로 연결하는 별도의 처리가 필요합니다.
- **VisualTree 재사용**: MVU의 특성상 상태가 변경될 때마다 View를 다시 그리는 것이 일반적이지만, WPF에서는 VisualTree를 완전히 다시 생성하는 것은 성능에 큰 영향을 줄 수 있습니다. 이를 위해 Diffing Algorithm을 적용하여 변경된 부분만 업데이트하는 방식이 필요합니다. 이 과정에서 WPF의 VisualTree를 효율적으로 비교하고 업데이트할 수 있는 방법을 구현하는 것이 핵심 과제입니다.

## 목표와 비전

- **간단한 컨트롤부터 시작**: `Grid`, `StackPanel`, `Button`, `TextBox`, `Label` 등 기본적인 컨트롤부터 MVU 방식으로 구현을 시도합니다. 이를 통해 WPF에서도 React와 같은 현대적인 UI 업데이트 방식을 도입할 수 있는 가능성을 열어보고자 합니다.
- **최적화된 Diffing Algorithm 개발**: WPF의 VisualTree와 잘 맞는 Diffing Algorithm을 개발하여 성능을 유지하면서도 MVU 패턴을 구현할 수 있도록 노력할 것입니다. 이를 통해 기존의 XAML 기반 개발자들도 쉽게 사용할 수 있는 MVU 라이브러리를 목표로 하고 있습니다.

오랜 시간이 걸릴 수 있지만, WPF에서도 현대적인 UI 개발 패러다임을 적용할 수 있는 길을 열어보고 싶습니다.